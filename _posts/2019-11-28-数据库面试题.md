---
layout:     post
title:      数据库面试题
subtitle:   数据库面试题
date:       2019/11/28
author:     zhaostu4
header-img: img/post-bg-ios10.jpg
catalog: true
tags:
	- 数据库
	- 数据库面试题
    - 学习笔记
---

>> T:2019/11/28  W:四 17:0:11

[HTML]: @[TOC](数据库面试题)

# 一、基本概念
## 1. 主键、外键、超键、候选键
- 超键: 在关系中唯一标识元组的属性集称为关系模式的超键. 一个属性可以作为超键,多个属性的组合亦可以作为超键. 超键包括候选键和主键.
- 候选键: 是最小的候选键,即没有冗余元素的超键
- 主键: 数据库表中对储存数据对象唯一和完整标识的数据列或者属性的组合. 一个数据列只能有一个主键,且主键的取值不能缺失,即不能为空值(NULL)
- 外键: 在一个表中存在的另一个表的主键
## 为什么用自增列作为主键
- 如果我们定义了主键(`PRIMARY KEY`)，那么`InnoDB`会选择主键作为聚集索引、如果没有显式定义主键，则`InnoDB`会选择第一个不包含有`NULL`值的唯一索引作为主键索引、如果也没有这样的唯一索引，则`InnoDB`会选择内置`6字节`长的`ROWID`作为隐含的聚集索引(`ROWID`随着行记录的写入而主键递增，这个`ROWID`不像`ORACLE`的`ROWID`那样可引用，**是隐含的**)。
- 数据记录本身被存于主索引（一颗`B+Tree`）的叶子节点上。这就要求同一个叶子节点内（大小为一个内存页或磁盘页）的各条数据记录按主键顺序存放，因此每当有一条新的记录插入时，MySQL会根据其主键将其插入适当的节点和位置，如果页面达到装载因子（`InnoDB`默认为`15/16`），则开辟一个新的页（节点）
- 如果使用非自增主键（如果身份证号或学号等），由于每次插入主键的值近似于随机，因此每次新纪录都要被插到现有索引页得中间某个位置，此时`MySQL`不得不为了将新记录插到合适位置而移动数据，甚至目标页面可能已经被回写到磁盘上而从缓存中清掉，此时又要从磁盘上读回来，这增加了很多开销，同时频繁的移动、分页操作造成了大量的碎片，得到了不够紧凑的索引结构，后续不得不通过`OPTIMIZE TABLE`来重建表并优化填充页面。
## 触发器的作用？
- 触发器是一种特殊的存储过程，主要是通过事件来触发而被执行的。
- 它可以强化约束，来维护数据的完整性和一致性，可以跟踪数据库内的操作从而不允许未经许可的更新和变化。
- 可以联级运算。如，某表上的触发器上包含对另一个表的数据操作，而该操作又会导致该表触发器被触发。
## 什么是存储过程？用什么来调用？
- 存储过程是一个预编译的`SQL`语句，优点是允许模块化的设计，就是说只需创建一次，以后在该程序中就可以调用多次。如果某次操作需要执行多次SQL，使用存储过程比单纯SQL语句执行要快。
- 调用：
	- 1）可以用一个命令对象来调用存储过程。
	- 2）可以供外部程序调用，比如：java程序。
## 存储过程的优缺点？
- 优点：
	- 1）存储过程是预编译过的，执行效率高。
	- 2）存储过程的代码直接存放于数据库中，通过存储过程名直接调用，减少网络通讯。
	- 3）安全性高，执行存储过程需要有一定权限的用户。
	- 4）存储过程可以重复使用，可减少数据库开发人员的工作量。
- 缺点：移植性差
## 存储过程与函数的区别
- Ref: [SQL中存储过程和函数的区别](https://www.cnblogs.com/Joetao/articles/2250516.html)
![存储过程与函数的区别](https://img-blog.csdnimg.cn/20191101151050840.png#pic_center)
## 什么叫视图？游标是什么？
- 视图：
	- 是一种虚拟的表，具有和物理表相同的功能。可以对视图进行增，改，查，操作.
	- 视图通常是一个表或者多个表的行或列的子集。
	- 对视图的修改会影响基本表。它使得我们获取数据更容易，相比多表查询。
- 游标：
	- 是对查询出来的结果集作为一个单元来有效的处理。
	- 游标可以定在该单元中的特定行，从结果集的当前行检索一行或多行。
	- 可以对结果集当前行做修改。
	- 一般不使用游标，但是需要逐条处理数据的时候，游标显得十分重要。
---
- [【数据库】SQLServer游标概念和作用](https://blog.csdn.net/It_sharp/article/details/83271763)
	- 游标实际上是一种能从包括多条数据记录的结果集中每次提取一条记录的机制。
	- 游标充当指针的作用。尽管游标能遍历结果中的所有行，但他一次只指向一行。
	- 概括来讲，`SQL`的游标是一种临时的数据库对象，既可以用来存放数据库表中的数据行副本，也可以指向存储在数据库中的数据行的指针。游标提供了在逐行的基础上操作表中数据的方法。
	- 游标的一个常见用途就是保存查询结果，以便以后使用。游标的结果集是有Select语句产生，如果处理过程需要重复使用一个记录集，那么创建一次游标而重复使用若干次，比重复查询数据库要快的多。
- [通过视图增删改数据注意事项](https://www.cnblogs.com/vuenote/archive/2018/10/30/9875117.html)
	- 需要对目标表的 UPDATE、INSERT 或 DELETE 权限（取决于执行的操作）。
	- 如果视图引用多个基表，则不能删除行。
	- 如果视图引用多个基表，只能更新属于单个基表的列。

如果视图引用多个基表，则不能插入行。
---
## 视图的优缺点
- 优点：
	 1) 对数据库的访问，因为视图可以有选择性的选取数据库里的一部分。
	 2) 用户通过简单的查询可以从复杂查询中得到结果。
	 3) 维护数据的独立性，视图可从多个表检索数据。
	 4) 对于相同的数据可产生不同的视图。
- 缺点：
	1) 性能：查询视图时，必须把视图的查询转化成对基本表的查询，如果这个视图是由一个复杂的多表查询所定义，那么，那么就无法更改数据
---
- [通过视图增删改数据注意事项](https://www.cnblogs.com/vuenote/archive/2018/10/30/9875117.html)
	- 需要对目标表的 `UPDATE`、`INSERT` 或 `DELETE` 权限（取决于执行的操作）。
	- 如果视图引用多个基表，则不能删除行。
	- 如果视图引用多个基表，只能更新属于单个基表的列。
---
## `drop`,`truncate`,`delete`区别
- 基本点：
	1) `drop`直接删掉表。
	2) `truncate`删除表中数据，再插入时自增长`id`又从`1`开始。
	3) `delete`删除表中数据，可以加`where`字句。
- 附加
	1) `DELETE`语句执行删除的过程是每次从表中删除一行，并且同时将该行的删除操作作为事务记录在日志中保存以便进行进行回滚操作。
	2) `TRUNCATE TABLE` 则一次性地从表中删除所有的数据并不把单独的删除操作记录记入日志保存，删除行是不能恢复的。**并且在删除的过程中不会激活与表有关的删除触发器。执行速度快**。
	3)  表和索引所占空间。当表被`TRUNCATE`后，这个表和索引所占用的空间会恢复到初始大小，而`DELETE`操作不会减少表或索引所占用的空间。`drop`语句将表所占用的空间全释放掉。
	4) 一般而言，`drop > truncate > delete`
	5) 应用范围。`TRUNCATE` 只能对`TABLE`；`DELETE`可以是`table和view`
	6) `TRUNCATE` 和`DELETE`只删除数据，而`DROP`则删除整个表（结构和数据）。
	7) ` truncate`与不带`where`的`delete` ：只删除数据，而不删除表的结构（定义）`drop`语句将删除表的结构被依赖的约束（constrain),触发器（trigger)索引（index);**依赖于该表的存储过程/函数将被保留，但其状态会变为：`invalid`。**
	8)  `delete`语句为`DML`（data maintain Language, 数据操作语言),这个操作会被放到 `rollback segment`中,事务提交后才生效。如果有相应的 `tigger`,执行的时候将被触发。
	9) `truncate、drop`是`DLL`（data define language, 数据定义语言),操作立即生效，原数据不放到 rollback segment中，不能回滚。
	10) 在没有备份情况下，谨慎使用 `drop`与 `truncate`。要删除部分数据行采用`delete`且注意结合`where`来约束影响范围。回滚段要足够大。要删除表用`drop`;若想保留表而将表中数据删除，如果于事务无关，用`truncate`即可实现。如果和事务有关，或老师想触发`trigger`,还是用`delete`。
	11) `Truncate table` 表名 速度快,而且效率高,因为:?truncate table 在功能上与不带 WHERE 子句的 DELETE 语句相同：二者均删除表中的全部行。但 TRUNCATE TABLE 比 DELETE 速度快，且使用的系统和事务日志资源少。DELETE 语句每次删除一行，并在事务日志中为所删除的每行记录一项。TRUNCATE TABLE 通过释放存储表数据所用的数据页来删除数据，并且只在事务日志中记录页的释放。
	12) `TRUNCATE TABLE` 删除表中的所有行，但表结构及其列、约束、索引等保持不变。新行标识所用的计数值重置为该列的种子。如果想保留标识计数值，请改用 DELETE。如果要删除表定义及其数据，请使用 DROP TABLE 语句。
	13) 对于由 `FOREIGN KEY` 约束引用的表，不能使用 `TRUNCATE TABLE`，而应使用不带 WHERE 子句的 DELETE 语句。由于 `TRUNCATE TABLE` 不记录在日志中，所以它不能激活触发器。

## 什么是临时表，临时表什么时候删除?
- 临时表可以手动删除：
	- `DROP TEMPORARY TABLE IF EXISTS temp_tb;`
- 临时表只在当前连接可见，当关闭连接时，MySQL会自动删除表并释放所有空间。
- 因此在不同的连接中可以创建同名的临时表，并且操作属于本连接的临时表。
- 创建临时表的语法与创建表语法类似，不同之处是增加关键字`TEMPORARY`，如：
	```sql
	CREATE TEMPORARY TABLE tmp_table (
	NAME VARCHAR (10) NOT NULL,
	time date NOT NULL
	);
	select * from tmp_table;
	```
## 非关系型数据库和关系型数据库区别，优势比较?
- 非关系型数据库的优势：
	- 性能：NOSQL是基于键值对的，可以想象成表中的主键和值的对应关系，而且不需要经过SQL层的解析，所以性能非常高。
	- 可扩展性：同样也是因为基于键值对，数据之间没有耦合性，所以非常容易水平扩展。
- 关系型数据库的优势：
	- 复杂查询：可以用SQL语句方便的在一个表以及多个表之间做非常复杂的数据查询。
	- 事务支持：使得对于安全性能很高的数据访问要求得以实现。
